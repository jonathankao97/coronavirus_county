{% extends 'base.html' %}
{% load static %}
{% block content %}
{% csrf_token %}
<style>
.nav-tabs > li.active > a {
    color: #a84ab7!important;
    }
body.modal-open {
    overflow: auto;
}
body.modal-open[style] {
    padding-right: 0px !important;
}

.modal::-webkit-scrollbar {
    width: 0 !important; /*removes the scrollbar but still scrollable*/
    /* reference: http://stackoverflow.com/a/26500272/2259400 */
}

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<div class="content my-0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2 mt-2"></div>
            <div class="col-md-auto mx-auto mt-2">
                <div class="card py-1">
                    <h3 class="card-title text-white text-center large pr-5 pl-5">{{ county.name }} County </h3>
                </div>
            </div>
            <div class="col-xl-2 col-lg-2 col-md-6 col-sm-6 ">
                <div class="card-transparent mt-3 p-0">
                    <div class="card-body pb-0 px-0">
                        <button type="submit" class="btn btn-primary pull-right" data-toggle="modal"
                           href="#myModal">Receive Updates</button>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="myModal" role="dialog" tabindex="-1" data-backdrop="false">
                <div class="modal-dialog" role="document">
                    <div class="card modal-content" style="background-color:#313952">
                        <div class="modal-header" style="border:none;">
                            <button class="close text-white mx-0 pull-right invisible" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h5 class="modal-title text-white mx-auto" id="exampleModalLabel">{{ county }} County
                            </h5>
                            <button class="close text-white mx-0 pull-right" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-header mx-3 py-0 my-0" style="border-color:#8f35aa;border-width:2px;"></div>
                        <form onsubmit="return false;">
                            <div class="modal-body pt-2 my-0" style="border:none;">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Email address</label>
                                                <input type="email" class="form-control" id="email"
                                                       required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Fist Name</label>
                                                <input type="text" class="form-control" id="first_name" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Last Name</label>
                                                <input type="text" class="form-control" id="last_name" required>
                                            </div>
                                        </div>
                                    </div>
                                    <h5 class="modal-title text-secondary text-center small pt-4">Provide your email for
                                        daily updates!</h5>
                                </div>
                            </div>
                            <div class="modal-footer pt-0 mt-0" style="border:none;">
                                <button type="submit" class="btn btn-primary pull-right" id="target">Submit</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row p-0">
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 ">
            <div class="card card-stats">
                <div class="card-header card-header-success card-header-icon">
                    <div class="card-icon">
                        <i class="fa fa-check"></i>
                    </div>
                    <p class="card-category">Confirmed Cases</p>
                    <div class="tab-content">
                        <div class="tab-pane active" id="c_day">
                            <h3 class="card-title text-light">+{{ confirmed_deltas.0 }}</h3>
                        </div>
                        <div class="tab-pane" id="c_week">
                            <h3 class="card-title text-light">+{{ confirmed_deltas.1 }}</h3>
                        </div>
                        <div class="tab-pane" id="c_month">
                            <h3 class="card-title text-light">+{{ confirmed_deltas.2 }}</h3>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <ul class="stats nav nav-tabs small font-weight-light mr-auto">
                        <li><i class="material-icons mr-2">update</i></li>
                        <li class="nav-item mr-2 active">
                            <a data-toggle="tab" href="#c_day" class="text-secondary">Day</a>
                        </li>
                        <li class="nav-item mr-2">
                            <a data-toggle="tab" href="#c_week" class="text-secondary">Week</a>
                        </li>
                        <li class="nav-item">
                            <a data-toggle="tab" href="#c_month" class="text-secondary">Month</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mt-0">
            <div class="card card-stats">
                <div class="card-header card-header-danger card-header-icon">
                    <div class="card-icon">
                        <i class="fas fa-skull-crossbones"></i>
                    </div>
                    <p class="card-category">Deceased</p>
                    <div class="tab-content">
                        <div class="tab-pane active" id="d_day">
                            <h3 class="card-title text-light">+{{ deaths_deltas.0 }}</h3>
                        </div>
                        <div class="tab-pane" id="d_week">
                            <h3 class="card-title text-light">+{{ deaths_deltas.1 }}</h3>
                        </div>
                        <div class="tab-pane" id="d_month">
                            <h3 class="card-title text-light">+{{ deaths_deltas.2 }}</h3>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <ul class="stats nav nav-tabs small font-weight-light mr-auto">
                        <li><i class="material-icons mr-2">update</i></li>
                        <li class="nav-item mr-2 active">
                            <a data-toggle="tab" href="#d_day" class="text-secondary">Day</a>
                        </li>
                        <li class="nav-item mr-2">
                            <a data-toggle="tab" href="#d_week" class="text-secondary">Week</a>
                        </li>
                        <li class="nav-item">
                            <a data-toggle="tab" href="#d_month" class="text-secondary">Month</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6">
            <div class="card card-stats">
                <div class="card-header card-header-info card-header-icon">
                    <div class="card-icon">
                        <i class="fas fa-flag-usa"></i>
                    </div>
                    <p class="card-category">{{ state.name }} Severity Rank</p>
                    <h3 class="card-title text-white">{{ state_rank }}<sup>{{ state_rank_sup }}</sup></h3>
                </div>
                <div class="card-footer">
                    <div class="stats small">
                        <i class="material-icons">flag</i> In the USA
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6">
            <div class="card card-stats">
                <div class="card-header card-header-warning card-header-icon">
                    <div class="card-icon">
                        <i class="material-icons">location_city</i>
                    </div>
                    <p class="card-category">County Severity Rank</p>
                    <h3 class="card-title text-white">{{ county_rank }}<sup>{{ county_rank_sup }}</sup></h3>
                </div>
                <div class="card-footer">
                    <div class="stats small">
                        <i class="material-icons">flag</i> In {{ state.name }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row p-0 m-0">
        <div class="card pt-2">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-toggle="tab" id="7">
                        <i class="fas fa-calendar-day fa-lg mr-2"></i> Week
                        <div class="ripple-container"></div>
                    </a>
                </li>
                <li class="nav-item" id="my">
                    <a class="nav-link" href="#" data-toggle="tab" id="14">
                        <i class="fas fa-calendar-week fa-lg mr-2"></i>2 Weeks
                        <div class="ripple-container"></div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-toggle="tab" id="30">
                        <i class="fas fa-calendar-alt fa-lg mr-2"></i> Month
                        <div class="ripple-container"></div>
                    </a>
                </li>
            </ul>
            <div class="card-body pb-0">
                <div class="row">
                    <div class="col-xl-6 col-lg-12">
                        <div class="card card-chart">
                            <div class="card-header card-header-success">
                                <canvas id="myAreaChart"></canvas>
                            </div>
                            <div class="card-body">
                                <h4 class="card-title">Confirmed Cases</h4>
                                <p class="card-category">
                                    <span class="text-success"><i class="fa fa-long-arrow-up"></i>{{ confirmed_increase }}% </span>
                                    in cases</p>
                            </div>
                            <div class="card-footer">
                                <div class="stats">
                                    <i class="material-icons">access_time</i> updated 2 hours ago
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-12">
                        <div class="card card-chart">
                            <div class="card-header card-header-danger">
                                <canvas id="myDeathChart"></canvas>
                            </div>
                            <div class="card-body">
                                <h4 class="card-title">Deceased</h4>
                                <p class="card-category">
                                <span class="text-danger"><i
                                        class="fa fa-long-arrow-up"></i> {{ death_increase }} % </span>
                                    in deaths</p>
                            </div>
                            <div class="card-footer">
                                <div class="stats">
                                    <i class="material-icons">access_time</i> updated 2 hours ago
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer pt-0">
                    <div class="stats pt-0">
                        <i class="material-icons text-danger">warning</i>
                        <a href="#pablo" class="danger-link">Get more info...</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var confirmed = {{ confirmed }}
    var confirmed_deltas = {{ confirmed_deltas | safe}}
    var deaths = {{ deaths }}
    var deaths_deltas = {{ deaths_deltas | safe}}
    var x_axis = {{ x_axis | safe}}

    function showNotification(e,a){
    $.notify({icon:"add_alert",
    message:"<p>You are now subscribed to receive daily updates for <strong>{{ county }}</strong> County!</p>"},
    {type:"success",timer:3e3,placement:{from:e,align:a}})
    }

    $( "#target" ).click(function() {
    var valid = $('#email')[0].checkValidity() && $('#first_name')[0].checkValidity() && $('#last_name')[0].checkValidity()
    if (valid){
      $('#myModal').hide();
      $.ajax({
            type: "POST",
            url: "/county/subscribe/",
            data: {
                'county_id': {{ county.id }},
                'email': $('#email').val(),
                'first_name': $('#first_name').val(),
                'last_name': $('#last_name').val(),
                'csrfmiddlewaretoken': $("input[name=csrfmiddlewaretoken]").val(),
            },
            success:searchSuccess,
            dataType: 'html'
        });
    }
    function searchSuccess(data, textStatus, jqXHR){
    showNotification('top','center');
    $.clearInput();
    }
});

$.clearInput = function () {
        $('form').find('input[type=text], input[type=password], input[type=number], input[type=email], textarea').val('');
};
</script>
{% endblock %}